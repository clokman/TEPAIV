<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Event listeners</title>
    <script type="text/javascript" src="./d3.js"></script>
    <style type="text/css">

        /*rect{*/
            /*-webkit-transition: all 0.25s;*/
            /*-moz-transition: all 0.25s;*/
            /*-ms-transition: all 0.25s;*/
            /*-o-transition: all 0.25s;*/
            /*transition: all 0.25s;*/
        /*}*/

        /*rect:hover{*/
            /*fill: orange;*/
        /*}*/

    </style>
</head>
<body>

<button id="sort-button">Sort</button> <br><br>

<script type="text/javascript">

    // Dataset
    var dataset = [ 5, 10, 13, 19, 21, 25, 22, 18, 15, 13,
        11, 12, 15, 20, 18, 17, 16, 18, 23, 25 ]

    // Width and height
    canvasWidth = 600
    canvasHeight = 250

    // Create Scales
    var xScale = d3.scaleBand()
        .domain(d3.range(dataset.length))
        .range([0, canvasWidth])
        .paddingInner(0.05)

    var yScale = d3.scaleLinear()
        .domain([0, d3.max(dataset)])
        .rangeRound([0, canvasHeight])

    // Create SVG element
    svg = d3.select('body')
            .append('svg')
            .attr('width', canvasWidth)
            .attr('height', canvasHeight)

    // Create bars
    bars = svg
        .selectAll('rect')
        .data(dataset)
        .enter()
        .append('rect')
            .attr('x', function (d, i) {
                return xScale(i)
            })
            .attr('y', function (d) {
                return canvasHeight-yScale(d)
            })
            .attr('height',  function (d) {
                return yScale(d)
            })
            .attr('width', xScale.bandwidth())
            .attr('fill', function (d) {
                return 'rgb(0,0,' + d * 10 + ')'
            })
            .on('click', function (d) {
            console.log(d)
            })
            .on('mouseover', function (d) {
                d3.select(this)
                    .attr('fill','green')
            })
            .on('mouseout', function (d) {
                d3.select(this)
                    .transition('restore-bar-color')
                    .duration(1000)
                    .attr('fill', 'rgb(0,0,' + (d * 10) +')')
            })



    //Create labels
    var labels = svg.selectAll('text')
        .data(dataset)
        .enter()
            .append('text')
            .text(function (d) {
                return d
            })
            .attr('x', function (d, i) {
                return ((xScale(i)) + (xScale.bandwidth()/2))
            })
            .attr('y', function (d) {
                return canvasHeight - yScale(d) + 14
            })
            .attr('fill', 'white')
            .attr('font-family', 'sans-serif')
            .attr('font-size', '6pt')
            .attr('text-anchor', 'middle')
            .attr('pointer-events', 'none')


    d3.select('#sort-button')
        .on('click', function () {

            console.log('Sort button clicked.')
            sortBars()

        })




    let currentSortOrder = 'none'
    function sortBars(){

        if (currentSortOrder !== 'ascending'){
            sort('rect', 'ascending')
            sort('text', 'ascending')
            currentSortOrder = 'ascending'
        }

        else if (currentSortOrder === 'ascending') {
            sort('rect', 'descending')
            sort('text', 'descending')
            currentSortOrder = 'descending'
        }


        /**
         * @param {string} selector
         * @param {string} direction - the sorting direction. can be 'ascending' or 'descending'.
         */
        function sort(selector, direction) {
            svg.selectAll(selector)
                .sort( function (a,b) {
                    if      (direction === 'ascending')  { return d3.ascending(a,b) }
                    else if (direction === 'descending') { return d3.descending(a,b) }
                })
                .transition('sort-bars-ascending').duration(1000).delay( (d,i) => i*25 )
                .attr('x', function (d,i) {
                    if (selector === 'text'){ return xScale(i) + xScale.bandwidth()/2 }
                    else                    { return xScale(i) }
                })
        }

    }


</script>
</body>
</html>