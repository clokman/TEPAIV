<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <title>Scales</title>

    <script type="text/javascript" src="d3.js"></script>


</head>

<body>

<p>Click on the chart to update it with new data.</p>

<script type="text/javascript">

    // PARAMS ////////////////////////////////////////////////

    var canvasHeight = 250;
    var canvasWidth = 600;
    var padding = 25;



    // Dynamic, random dataset
    var dataset = [];
    var numDataPoints = 50;
    var xRange = Math.random() * 1000;
    var yRange = Math.random() * 1000;
    for (var i = 0; i < numDataPoints; i++) {
        var newNumber1 = Math.floor(Math.random() * xRange);
        var newNumber2 = Math.floor(Math.random() * yRange);
        dataset.push([newNumber1, newNumber2]);
    }


    // var dataset = [
    //     [5,     20],
    //     [480,   90],
    //     [250,   50],
    //     [100,   33],
    //     [330,   95],
    //     [410,   12],
    //     [475,   44],
    //     [25,    67],
    //     [85,    21],
    //     [220,   88],
    //     [600,   150]
    // ];



    // SCALES ////////////////////////////////////////////////
    var xMax = d3.max(dataset, function (d) {return d[0]});
    var yMax = d3.max(dataset, function (d) {return d[1]});

    var xScale = d3.scaleLinear()
        .domain([0, xMax])
        .rangeRound([padding * 1.1, canvasWidth-padding]);

    var  yScale = d3.scaleLinear()
            .domain([0, yMax])
            .rangeRound([canvasHeight - (padding * 1.2), padding]);



    // CANVAS //////////////////////////////////////////////

    var svg = d3.select('body')
        .append('svg')
        .attr('width', canvasWidth)
        .attr('height', canvasHeight);



    // CLIP PATH //////////////////////////////////////////

    svg.append('clipPath')
        .attr('id', 'chart-area')
        .append('rect')
            .attr('x', padding)
            .attr('y', padding)
            .attr('width', canvasWidth-padding * 2)
            .attr('height', canvasHeight-padding * 2);

    // CIRCLES //////////////////////////////////////////////

    let scatterPlotSymbolSize = 2;
    var circles = svg
        .append('g')
            .attr('id', 'circles')
            .attr('clip-path', 'url(#chart-area)')  // apply clipPath
        .selectAll('circle')
        .data(dataset)
        .enter()
        .append('circle')
        .attr('cx', function (d) {
            return xScale(d[0])
        })
        .attr('cy', function (d) {
            return yScale(d[1])
        })
        .attr('r', scatterPlotSymbolSize)
        .attr('fill', 'gray');



    // AXES //////////////////////////////////////////////

    // Define X axis
    var xAxis = d3.axisBottom()
        .scale(xScale)
        .ticks(5);


    // Create X axis
    svg.append('g')
        .call(xAxis)
        .attr('class', 'x axis')
        .attr('transform', 'translate(0,' + (canvasHeight - padding) + ')');



    // Define Y axis
    var yAxis = d3.axisLeft()
        .scale(yScale)
        .ticks(5);

    // Create Y axis
    svg.append('g')
        .call(yAxis)
        .attr('class', 'y axis')
        .attr('transform', 'translate(' + padding + ',0)');


    // UPDATE  //////////////////////////////////////////////////

    d3.select('svg')
        .on('click', function () {

            // Update the dataset with random data
            dataset = [];
            var numDataPoints = 50;
            var xRange = Math.random() * 1000;
            var yRange = Math.random() * 1000;
            for (var i = 0; i < numDataPoints; i++) {
                var newNumber1 = Math.floor(Math.random() * xRange);
                var newNumber2 = Math.floor(Math.random() * yRange);
                dataset.push([newNumber1, newNumber2]);
            }


            // Update scales
            xMax = d3.max(dataset, function (d) {return d[0]});
            yMax = d3.max(dataset, function (d) {return d[1]});

            xScale = d3.scaleLinear()
                .domain([0, xMax])
                .rangeRound([padding * 1.1, canvasWidth-padding]);

            yScale = d3.scaleLinear()
                .domain([0, yMax])
                .rangeRound([canvasHeight - (padding * 1.2), padding]);




            // Update X axis
            xAxis = d3.axisBottom()
                    .scale(xScale)
                    .ticks(5);

            svg.select('.x.axis')
                .transition()
                .duration(1000)
                .call(xAxis);


            // Update Y axis
            yAxis = d3.axisLeft()
                .scale(yScale)
                .ticks(5);

            svg.select('.y.axis')
                .transition()
                .duration(1000)
                .call(yAxis);


            // Update symbols
            svg.selectAll('circle')
                .data(dataset)
                .transition()
                .delay(function (d, i) {
                    return i * 25
                })
                .duration(1000)
                .on('start', function (d) {
                    d3.select(this)
                        .attr('fill', 'red')
                })
                .attr('cx', function (d) {
                    return xScale(d[0])
                })
                .attr('cy', function (d) {
                    return yScale(d[1])
                })
                // .on('end', function (d) {
                //     d3.select(this)
                //         .transition()
                //         .duration(2500)
                //         .attr('fill', 'gray')
                // })
                .transition()
                .duration(2000)
                .attr('fill', 'gray')
                .transition()
                .delay(0)
                .duration(250)
                .attr('r', scatterPlotSymbolSize * 2)
                .transition()
                .delay(0)
                .duration(250)
                .attr('r', scatterPlotSymbolSize);
        })





</script>

</body>

</html>