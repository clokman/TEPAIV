<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Paths</title>
    <script type="text/javascript" src="./d3.js"></script>
    <style type="text/css">

    .below-limit-line{
        fill: none;
        stroke-width: 1px;
        stroke: black;
    }

    .above-limit-line{
        fill: none;
        stroke-width: 1px;
        stroke: red;
    }

    .line-safeLevel{
        fill: none;
        stroke-width: 1px;
        stroke: red;
        stroke-dasharray: 3px;
    }

    .safe-level-label{
        font-size: 12px;
        font-family: sans-serif;
        fill: red;
    }

    </style>
</head>
<body>


<script type="text/javascript">


    // Width and height
    const canvasWidth = 600,
          canvasHeight = 250,
          padding = 35

    d3.csv('mauna_loa_co2_monthly_averages.csv', function (d) {
        return {
            date: new Date(+d.year, +d.month-1),  // combine two columns into a date object
            average: parseFloat(d.average)        // parse column as float (i.e., convert from string)
        }
    }).then(function (data) {

        console.table(data, ['date', 'average'])  // view data


        // Create Scales
        const dateScale = d3.scaleTime()
            .domain( d3.extent( data, d => d.date ) )
            .range([ padding, canvasWidth ])


        const carbonMinimum = d3.min(data, function (d) {
            if (d.average >= 0){        // exclude values below 0
                return d.average - 10   // add offset
            }
        })

        const carbonMaximum = d3.max( data, d => d.average )

        const carbonScale = d3.scaleLinear()
            .domain([ carbonMinimum, carbonMaximum ])
            .range([canvasHeight-padding, 0])



        // Create SVG element
        const svg = d3.select('body')
            .append('svg')
            .attr('width', canvasWidth)
            .attr('height', canvasHeight)



        // Specify below limit line
        const belowLimitLine = d3.line()
            .defined(d => d.average >= 0 && d.average <= 350)
            .x( d => dateScale(d.date) )
            .y( d => carbonScale(d.average) )

        // Draw below limit line
        svg.append('path')
            .datum(data)
            .attr('class', 'below-limit-line')
            .attr('d', belowLimitLine)
            // styled with CSS

        // Specify above limit line
        const aboveLimitLine = d3.line()
            .defined(d => d.average >= 350)
            .x( d => dateScale(d.date) )
            .y( d => carbonScale(d.average) )

        // Draw above limit line
        svg.append('path')
            .datum(data)
            .attr('class', 'above-limit-line')
            .attr('d', aboveLimitLine)
            // styled with CSS



        // Create axes
        let yAxis = d3.axisLeft()
            .scale(carbonScale)
            .ticks(10)

        svg.append('g')
            .attr('class', 'axis')
            .attr('transform', 'translate('+ padding +','+ 0 + ')')
            .call(yAxis)


        let xAxis = d3.axisBottom()
            .scale(dateScale)
            .ticks(10)

        svg.append('g')
            .attr('class', 'axis')
            .attr('transform', 'translate(0,' + (canvasHeight-padding / 1.75) + ')')
            .call(xAxis)



        //Create the red limit line
        svg.append('line')
            .attr('class', 'line-safeLevel')
            .attr('x1', padding)
            .attr('x2', canvasWidth)
            .attr('y1', carbonScale(350))
            .attr('y2', carbonScale(350))
            // styled with CSS

        // console.log(data)  // view data

        //Create the red limit text
        svg.append('text')
            .text('350 ppm "safe" level')
            .attr('class', 'safe-level-label')
            .attr('x', padding + 5)
            .attr('y', carbonScale(350) - 8)
            // styled with CSS


    })

</script>

</body>
</html>